@media print {
  /* 隐藏非打印元素 */
  header, nav, footer, button, .no-print, .toast-container {
    display: none !important;
  }

  /* 确保内容填满页面 */
  body, #root, main {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: auto !important;
    background-color: white !important;
    overflow: visible !important;
    display: block !important;
  }

  /* 重置主布局容器 */
  .min-h-screen {
    min-height: auto !important;
    display: block !important;
  }

  /* 重置最大宽度限制 */
  .max-w-7xl {
    max-width: none !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  /* 针对各页面的布局调整 - 只重置页面级的 grid/flex */
  main > .grid,
  main > .flex,
  .page-container > .grid {
    display: block !important;
  }

  /* 保留生成器内部的网格布局 */
  .print\:grid-cols-3 {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
  }

  .print\:grid-cols-5,
  .print\:grid.print\:grid-cols-5 {
    display: grid !important;
    grid-template-columns: repeat(5, 1fr) !important;
  }

  .print\:grid-cols-9 {
    display: grid !important;
    grid-template-columns: repeat(9, 1fr) !important;
  }

  .print\:grid-cols-8 {
    display: grid !important;
    grid-template-columns: repeat(8, 1fr) !important;
  }

  /* 数学题目行 - 必须保留 grid 布局 */
  .problem-row {
    display: grid !important;
  }

  .problem-row.grid-cols-3 {
    grid-template-columns: repeat(3, 1fr) !important;
  }

  .problem-row.grid-cols-5 {
    grid-template-columns: repeat(5, 1fr) !important;
  }

  /* 答案页的网格 */
  .grid.grid-cols-5 {
    display: grid !important;
    grid-template-columns: repeat(5, 1fr) !important;
  }

  /* 恢复 flex 布局的特定元素 */
  .flex.items-center:not(.no-print),
  .flex.items-end:not(.no-print),
  .flex.justify-between:not(.no-print),
  .flex.gap-2:not(.no-print),
  .problem-item {
    display: flex !important;
  }

  /* 极高优先级的隐藏规则 */
  .no-print, .no-print * {
    display: none !important;
  }

  /* A4 纸张优化 */
  @page {
    size: A4;
    margin: 0; /* 页面内部已有 padding，这里设为 0 */
  }

  /* A4 页面容器 */
  .a4-page {
    width: 210mm !important;
    min-height: 297mm !important;
    height: 297mm !important;
    padding: 10mm 10mm 20mm 10mm !important;
    margin: 0 !important;
    box-shadow: none !important;
    border: none !important;
    page-break-after: always !important;
    break-after: page !important;
  }

  .a4-page:last-child {
    page-break-after: auto !important;
    break-after: auto !important;
  }

  /* 工作表容器 */
  .worksheet-container {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* 避免分页断开 - 单个题目 */
  .problem-item, .grid-cell, .card-container {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
  }

  /* 避免分页断开 - 题目行（最重要） */
  .problem-row {
    page-break-inside: avoid !important;
    break-inside: avoid !important;
    -webkit-column-break-inside: avoid !important;
  }

  /* 固定页脚：打印时每页底部显示 */
  .print-footer {
    display: block !important;
    position: fixed !important;
    bottom: 0.5cm !important;
    left: 0 !important;
    right: 0 !important;
    text-align: center !important;
    font-size: 9pt !important;
    color: #9ca3af !important;
    background: white !important;
    z-index: 9999 !important;
  }

  /* 强制分页 */
  .page-break {
    page-break-before: always;
    break-before: page;
  }

  /* 颜色优化：保留特定颜色，但背景纯白 */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    box-shadow: none !important;
  }

  /* 特殊颜色处理：让灰色更深一点以便打印 */
  .text-gray-300, .text-gray-400 {
    color: #cbd5e1 !important; /* light gray */
  }

  /* 描红文字颜色 */
  .print\:text-gray-200 {
    color: #e2e8f0 !important;
  }

  /* 田字格/四线格颜色 */
  .border-red-500, .print\:border-red-600 {
    border-color: #dc2626 !important;
  }
  .border-red-300, .print\:border-red-300, .print\:border-red-400 {
    border-color: #fca5a5 !important;
  }

  /* 隐藏打印时的无关边框和阴影 */
  .shadow-sm, .shadow-md, .shadow-lg {
    box-shadow: none !important;
  }

  /* 确保容器没有不必要的边距 */
  .bg-white.p-8.shadow-sm.border {
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
    box-shadow: none !important;
  }
}
